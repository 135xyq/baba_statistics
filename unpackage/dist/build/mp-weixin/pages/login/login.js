(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"0362":function(e,n,t){"use strict";var o=t("5e74"),r=t.n(o);r.a},"1e8b":function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("c541"),t("a9ff");o(t("66fd"));var r=o(t("ee2b"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"5e74":function(e,n,t){},"73bc":function(e,n,t){"use strict";(function(e,o){var r=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=r(t("2eee")),i=r(t("9523")),u=r(t("c973")),s=r(t("604a"));function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,i.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var l={data:function(){return{openId:"",isLogin:!1,userInfo:{avatar:s.default,nickName:""}}},onShow:function(){var e,n;if(null!==(e=this.$store.state.userInfo)&&void 0!==e&&null!==(n=e.userInfo)&&void 0!==n&&n.openid){var t,o=null===(t=this.$store.state.userInfo)||void 0===t?void 0:t.userInfo;this.isLogin=!0,this.openId=o.openid,this.userInfo.avatar=o.avatarUrl,this.userInfo.nickName=o.nickName}},methods:{getCode:function(){return new Promise((function(n,t){e.login({provider:"weixin",success:function(e){n(e)},fail:function(e){t(new Error("获取code失败"))}})}))},wxLogin:function(){var n=this;return(0,u.default)(a.default.mark((function t(){var r,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.getCode();case 2:r=t.sent,i=r.code,e.request({url:"https://api.weixin.qq.com/sns/jscode2session?appid=wxf600daae2dc114e6&secret=1dd92382dbe76240929007795b89005e&js_code=".concat(i,"&grant_type=authorization_code"),method:"GET"}).then((function(t){n.openId=t.data.openid,e.showModal({title:"温馨提示",content:"授权微信登录后才能正常使用小程序功能",success:function(t){if(t.confirm)e.showLoading({title:"登录中..."}),e.getUserProfile({desc:"获取你的昵称、头像",success:function(t){console.log(t,2222),console.log(t.userInfo),t.rawData=JSON.parse(t.rawData),o.callFunction({name:"user_login",data:f(f({},t.userInfo),{},{openid:n.openId}),success:function(){var t=(0,u.default)(a.default.mark((function t(r){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.showToast({title:"登录成功",icon:"success",duration:2e3}),t.next=3,o.callFunction({name:"get_user_info",data:{openid:n.openId},success:function(e){n.$store.dispatch("userInfo/updateUserInfo",e.result.data),n.isLogin=!0,n.userInfo.nickName=n.$store.state.userInfo.userInfo.nickName,n.userInfo.avatar=n.$store.state.userInfo.userInfo.avatarUrl,n.userInfo.openid=n.$store.state.userInfo.userInfo.openid}});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),fail:function(n){e.hideLoading(),e.showToast({title:"登陆失败",icon:"error",duration:2e3})}}),e.hideLoading()},fail:function(n){e.hideLoading(),e.showToast({title:"拒绝授权",icon:"error",duration:2e3})}});else if(t.cancel)return void e.showToast({title:"您拒绝了授权",icon:"error",duration:2e3})}})}));case 5:case"end":return t.stop()}}),t)})))()},onHandleGoPageUserSet:function(){e.navigateTo({url:"/pages/set/set"})},logout:function(){var n=this;e.showModal({title:"提示",content:"确定退出登录？",success:function(e){e.confirm?(n.$store.dispatch("userInfo/clearUserInfo"),n.isLogin=!1,n.userInfo={avatar:s.default,nickName:""}):e.cancel}})},onHandleToChartsPage:function(){e.navigateTo({url:"/pages/chartsPage/chartsPage"})},onHandleToHistoryPage:function(){e.navigateTo({url:"/pages/historyPage/historyPage"})},onHandleToProblemChartPage:function(){e.navigateTo({url:"/pages/problemMonthChart/problemMonthChart"})},onHandleToTimeCountPage:function(){e.navigateTo({url:"/pages/timeCount/timeCount"})}}};n.default=l}).call(this,t("543d")["default"],t("a9ff")["default"])},a616:function(e,n,t){"use strict";t.r(n);var o=t("73bc"),r=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=r.a},ee2b:function(e,n,t){"use strict";t.r(n);var o=t("fef5"),r=t("a616");for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);t("0362");var i=t("f0c5"),u=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=u.exports},fef5:function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"d3aa"))},uAvatar:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-avatar/u-avatar")]).then(t.bind(null,"b88f"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"5461"))}},r=function(){var e=this.$createElement;this._self._c},a=[]}},[["1e8b","common/runtime","common/vendor"]]]);